(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,a){},16:function(e,t,a){},18:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(7),i=a.n(o),c=(a(14),a(1)),s=a(2),l=a(4),d=a(3),u=a(5),m=(a(16),function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).videoRef=n.createRef(),a.audioRef=n.createRef(),a.bgAudioRef=n.createRef(),a.ctx=new(window.AudioContext||window.webkitAudioContext),a.sourceNode=a.ctx.createBufferSource(),a.lastPauseTime=new Date,a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.audioRef.current&&this.audioRef.current.addEventListener("ended",function(){e.props.onComplete&&e.props.onComplete()})}},{key:"shouldComponentUpdate",value:function(e){return!1}},{key:"playIfNotPlaying",value:function(){this.audioRef.current&&(this.audioRef.current.paused&&((new Date).getTime()-this.lastPauseTime.getTime()>5e3&&this.audioRef.current.load(),this.audioRef.current.play()))}},{key:"pause",value:function(){this.audioRef.current&&(this.lastPauseTime=new Date,this.audioRef.current.pause())}},{key:"fadeTransition",value:function(e){var t=this;console.log("Fading"),this.videoRef.current&&(this.videoRef.current.classList.add("fade"),setTimeout(function(){t.videoRef.current.classList.remove("fade")},600),setTimeout(function(){t.loadVideo(e)},600))}},{key:"fadeOut",value:function(e){if(!this.videoRef.current)return e();this.videoRef.current.classList.add("fade"),setTimeout(e,600)}},{key:"loadVideo",value:function(e){(console.log("Loading video",e.name),this.setState({media:e}),this.videoRef.current&&e&&(e.video?(this.videoRef.current.src=e.video,this.videoRef.current.load()):this.videoRef.current.src="broken"),this.audioRef.current&&(e.dialog?(console.log("Has dialog!"),this.audioRef.current.src=e.dialog,this.audioRef.current.load()):this.audioRef.current.src="broken"),this.bgAudioRef.current)&&(e.bgaudio&&e.hasBg?(this.bgAudioRef.current.src=e.bgaudio,this.bgAudioRef.current.load(),window.AudioContext&&this.ctx.createMediaElementSource(this.bgAudioRef.current).connect(this.ctx.destination)):this.bgAudioRef.current.src="broken")}},{key:"render",value:function(){var e,t;return e=this.props.media.video?n.createElement("video",{className:"cinemagraph",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,ref:this.videoRef},n.createElement("source",{src:this.props.media.video,type:this.props.media.videoType})):n.createElement("video",{className:"cinemagraph",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,ref:this.videoRef}),this.props.silent||(t=n.createElement("div",null,n.createElement("audio",{autoPlay:!0,loop:!0,ref:this.bgAudioRef}),n.createElement("audio",{autoPlay:!0,ref:this.audioRef}))),n.createElement("div",null,e,t)}}]),t}(n.Component));var f,p=[{name:"title",ignore:!0},{name:"headphones",text:"this experience requires sound.",noAudio:!0},{name:"bed"},{name:"shower",hasBg:!0},{name:"street"},{name:"parks"},{name:"plaque"},{name:"garbagedump"},{name:"slide"},{name:"bench"},{name:"fountain"},{name:"drugdealers"},{name:"dolores"},{name:"urethra"},{name:"forest"},{name:"forest2"},{name:"canal"},{name:"slidetop"},{name:"poem"}],h=function(e){return r.a.createElement("div",null,r.a.createElement(m,{media:e.media,silent:!0}),r.a.createElement("div",{id:"menu"},r.a.createElement("h1",null,"G\xf6rli"),r.a.createElement("p",null,"by ",r.a.createElement("a",{href:"https://lazerwalker.com",target:"_blank"},"@lazerwalker")),r.a.createElement("p",null,"made for ",r.a.createElement("a",{href:"https://itch.io/jam/flatjam2018/",target:"_blank"},"flatjam 2018")),r.a.createElement("button",{id:"start",onClick:e.onStart},r.a.createElement("div",{id:"play-icon"}))))};!function(e){e[e.NotStarted=0]="NotStarted",e[e.Playing=1]="Playing",e[e.Complete=2]="Complete",e[e.MainMenu=3]="MainMenu"}(f||(f={}));var v=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).playerRef=r.a.createRef(),a.progressBarRef=r.a.createRef(),a.cache={},a.startGame=function(){a.setState({playState:f.NotStarted,index:a.nextIndex(0)})},a.clickedNext=function(){if(p[a.state.index].noAudio||a.state.playState===f.Complete){var e=a.nextIndex();if(e){a.setState({index:e,playState:f.NotStarted});var t=p[e],n=a.cache[t.name];a.playerRef.current&&a.playerRef.current.fadeTransition(n)}else a.playerRef.current&&a.playerRef.current.fadeOut(function(){a.setState({index:0,playState:f.MainMenu})})}},a.nextIndex=function(e){for(var t=(void 0===e?a.state.index:e)+1;p[t]&&p[t].ignore;)t+=1;if(!(t>=p.length))return t},a.stopAudio=function(){a.playerRef.current&&a.playerRef.current.pause()},a.onComplete=function(){console.log("Is complete!"),a.setState({playState:f.Complete})},a.state={index:-1,playState:f.MainMenu,loaded:!1,loadingProgress:0},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;function t(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))}window.addEventListener("resize",t),t(),window.addEventListener("keypress",this.clickedNext),function(e,t){var a=0,n=e.length,r=""!=document.createElement("video").canPlayType("video/webm")?"webm":"mp4",o="video/".concat(r);function i(e){return fetch(e,{mode:"cors"}).then(function(e){return console.log("fetched!",e),e}).then(function(e){return e.blob()}).then(URL.createObjectURL).catch(function(t){return console.log("Couldn't load ".concat(e,", ").concat(t))})}var c=e.map(function(e){return{bgaudio:"bgaudio/".concat(e.name,".mp3"),dialog:"dialog/".concat(e.name,".mp3"),name:e.name,video:"cinemagraphs/".concat(e.name,".").concat(r),hasBg:e.hasBg||!1,videoType:o}}).map(function(e){var t=[e.bgaudio,e.dialog,e.video];return Promise.all(t.map(i)).then(function(t){return{bgaudio:t[0],dialog:t[1],name:e.name,video:t[2],hasBg:e.hasBg,videoType:e.videoType}})});return Promise.all(c.map(function(e){return e.then(function(e){a+=1;var r=Math.floor(a/n*100);return t(r),e})})).then(function(e){var t={};return e.forEach(function(e){t[e.name]=e}),t})}(p,function(t){e.progressBarRef.current&&(e.progressBarRef.current.value=t)}).then(function(t){e.cache=t,e.setState({loaded:!0});var a=p[0];e.cache[a.name]})}},{key:"render",value:function(){if(console.log("Re-rendering"),!this.state.loaded)return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"video-wrapper"},r.a.createElement("div",null,"loading!"),r.a.createElement("progress",{ref:this.progressBarRef,value:this.state.loadingProgress,max:"100"})));if(this.state.playState===f.MainMenu)return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"video-wrapper"},r.a.createElement(h,{onStart:this.startGame,media:this.cache.title})));var e,t=p[this.state.index],a=r.a.createElement("div",{id:"next-wrapper",className:t.noAudio||this.state.playState===f.Complete?"visible":"hidden"},r.a.createElement("div",{id:"next",onClick:this.clickedNext},"\u2192"));return t.text&&(e=r.a.createElement("div",{className:"text",dangerouslySetInnerHTML:{__html:t.text}})),r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"video-wrapper"},r.a.createElement(m,{media:this.cache[t.name],ref:this.playerRef,onComplete:this.onComplete}),e,a))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(v,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,a){e.exports=a(18)}},[[8,2,1]]]);
//# sourceMappingURL=main.c3398969.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,a){},16:function(e,t,a){},18:function(e,t,a){"use strict";a.r(t);var n,o=a(0),r=a.n(o),i=a(7),c=a.n(i),s=(a(14),a(1)),l=a(2),u=a(4),d=a(3),p=a(5),f=(a(16),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).videoRef=o.createRef(),a.audioRef=o.createRef(),a.bgAudioRef=o.createRef(),a.ctx=new(window.AudioContext||window.webkitAudioContext),a.lastPauseTime=new Date,a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.audioRef.current&&this.audioRef.current.addEventListener("ended",function(){e.props.onComplete&&e.props.onComplete()})}},{key:"shouldComponentUpdate",value:function(e){return!1}},{key:"playIfNotPlaying",value:function(){this.audioRef.current&&(this.audioRef.current.paused&&((new Date).getTime()-this.lastPauseTime.getTime()>5e3&&this.audioRef.current.load(),this.audioRef.current.play()))}},{key:"pause",value:function(){this.audioRef.current&&(this.lastPauseTime=new Date,this.audioRef.current.pause())}},{key:"loadVideo",value:function(e){var t=this;console.log("Loiading video",e.name),this.setState({media:e}),this.videoRef.current&&(this.videoRef.current.src=e.video,this.videoRef.current.load()),this.audioRef.current&&(this.audioRef.current.src=e.dialog);var a,n,o=e.bgaudio;fetch(o,{mode:"cors"}).then(function(e){return e.arrayBuffer()}).then(function(e){t.ctx.decodeAudioData(e,r)});var r=function(e){a||(a=e),(n=t.ctx.createBufferSource()).buffer=e,n.connect(t.ctx.destination),n.loop=!0,n.start()}}},{key:"render",value:function(){return o.createElement("div",null,o.createElement("video",{className:"cinemagraph",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,ref:this.videoRef}),o.createElement("audio",{autoPlay:!0,loop:!0,ref:this.bgAudioRef}),o.createElement("audio",{ref:this.audioRef}))}}]),t}(o.Component));!function(e){e[e.NotStarted=0]="NotStarted",e[e.Playing=1]="Playing",e[e.Complete=2]="Complete"}(n||(n={}));var m=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).playerRef=r.a.createRef(),a.progressBarRef=r.a.createRef(),a.cache={},a.videos=[{name:"bed",keypresses:["ArrowUp"],playCoord:{x:20,y:60},nextCoord:{x:70,y:60}},{name:"shower",keypresses:["ArrowDown"],playCoord:{x:40,y:70},nextCoord:{x:70,y:50}},{name:"street"},{name:"parks"},{name:"drugdealers"},{name:"turkey"},{name:"keepwalking"},{name:"dolores"},{name:"urethra"},{name:"google"},{name:"fork"},{name:"slide"},{name:"up"},{name:"stumble"},{name:"run"},{name:"canal"},{name:"across"},{name:"slidetop"}],a.onKeyDown=function(e){a.state.playState===n.Complete?a.next():a.state.playState===n.NotStarted&&(a.playerRef.current.playIfNotPlaying(),a.setState({playState:n.Playing}))},a.onTouchStart=function(e){a.state.playState===n.Complete?a.next():a.state.playState===n.NotStarted&&(a.playerRef.current.playIfNotPlaying(),a.setState({playState:n.Playing}))},a.clickedTouchPoint=function(){a.state.playState===n.Complete?a.next():a.state.playState===n.NotStarted&&(a.playerRef.current.playIfNotPlaying(),a.setState({playState:n.Playing}))},a.stopAudio=function(){a.playerRef.current&&a.playerRef.current.pause()},a.onComplete=function(){console.log("Is complete!"),a.setState({playState:n.Complete})},a.state={index:0,keypressIndex:0,keyTimeout:1e3,playState:n.NotStarted,loaded:!1,loadingProgress:0},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;function t(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))}window.addEventListener("resize",t),t(),function(e,t){var a=0,n=e.length,o=""!=document.createElement("video").canPlayType("video/webm")?"webm":"mp4";function r(e){return fetch(e,{mode:"cors"}).then(function(e){return e.blob()}).then(URL.createObjectURL)}var i=e.map(function(e){return{bgaudio:"bgaudio/".concat(e,".mp3"),dialog:"dialog/".concat(e,".mp3"),name:e,video:"cinemagraphs/".concat(e,".").concat(o)}}).map(function(e){var t=[e.bgaudio,e.dialog,e.video];return Promise.all(t.map(r)).then(function(t){return{bgaudio:t[0],dialog:t[1],name:e.name,video:t[2]}})});return Promise.all(i.map(function(e){return e.then(function(e){a+=1;var o=Math.floor(a/n*100);return t(o),e})})).then(function(e){var t={};return e.forEach(function(e){t[e.name]=e}),t})}(this.videos.map(function(e){return e.name}),function(t){e.progressBarRef.current&&(e.progressBarRef.current.value=t)}).then(function(t){e.cache=t,e.setState({loaded:!0});var a=e.videos[0],n=e.cache[a.name];setTimeout(function(){e.playerRef.current.loadVideo(n)},100)})}},{key:"render",value:function(){if(console.log("Re-rendering"),!this.state.loaded)return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"video-wrapper"},r.a.createElement("div",null,"Loading!"),r.a.createElement("progress",{ref:this.progressBarRef,value:this.state.loadingProgress,max:"100"})));var e,t=this.videos[this.state.index];return this.state.playState===n.NotStarted?e=r.a.createElement("div",{id:"next-wrapper",onClick:this.clickedTouchPoint,style:{left:"".concat(t.playCoord.x,"%"),top:"".concat(t.playCoord.y,"%")}},r.a.createElement("div",{id:"next"})):this.state.playState===n.Complete&&(e=r.a.createElement("div",{id:"next-wrapper",onClick:this.clickedTouchPoint,style:{left:"".concat(t.nextCoord.x,"%"),top:"".concat(t.nextCoord.y,"%")}},r.a.createElement("div",{id:"next"}))),r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"video-wrapper"},r.a.createElement(f,{media:this.cache[t.name],ref:this.playerRef,onComplete:this.onComplete}),e))}},{key:"next",value:function(){var e=this,t=this.state.index>=this.videos.length-1?0:this.state.index+1;this.setState({index:t,keypressIndex:0,playState:n.NotStarted});var a=this.videos[t],o=this.cache[a.name];setTimeout(function(){e.playerRef.current&&e.playerRef.current.loadVideo(o)},10)}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(m,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,a){e.exports=a(18)}},[[8,2,1]]]);
//# sourceMappingURL=main.2778ab63.chunk.js.map
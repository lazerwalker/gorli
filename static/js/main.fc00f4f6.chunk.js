(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){},16:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(7),i=n.n(r),c=(n(14),n(1)),u=n(2),s=n(4),d=n(3),l=n(5),m=(n(16),function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).videoRef=a.createRef(),n.audioRef=a.createRef(),n.bgAudioRef=a.createRef(),n.ctx=new(window.AudioContext||window.webkitAudioContext),n.lastPauseTime=new Date,n}return Object(l.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.audioRef.current&&this.audioRef.current.addEventListener("ended",function(){e.props.onComplete&&e.props.onComplete()})}},{key:"shouldComponentUpdate",value:function(e){return!1}},{key:"playIfNotPlaying",value:function(){this.audioRef.current&&(this.audioRef.current.paused&&((new Date).getTime()-this.lastPauseTime.getTime()>5e3&&this.audioRef.current.load(),this.audioRef.current.play()))}},{key:"pause",value:function(){this.audioRef.current&&(this.lastPauseTime=new Date,this.audioRef.current.pause())}},{key:"loadVideo",value:function(e){var t=this;console.log("Loading video",e.name),this.setState({media:e}),this.videoRef.current&&e&&(e.video?(this.videoRef.current.src=e.video,this.videoRef.current.load()):this.videoRef.current.src="broken"),this.audioRef.current&&(e.dialog?(console.log("Has dialog!"),this.audioRef.current.src=e.dialog,this.audioRef.current.load()):this.audioRef.current.src="broken");var n,a,o=e.bgaudio;o&&fetch(o,{mode:"cors"}).then(function(e){return e.arrayBuffer()}).then(function(e){t.ctx.decodeAudioData(e,r)});var r=function(e){n||(n=e),(a=t.ctx.createBufferSource()).buffer=e,a.connect(t.ctx.destination),a.loop=!0,a.start()}}},{key:"render",value:function(){return a.createElement("div",null,a.createElement("video",{className:"cinemagraph",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,ref:this.videoRef}),a.createElement("audio",{autoPlay:!0,loop:!0,ref:this.bgAudioRef}),a.createElement("audio",{autoPlay:!0,ref:this.audioRef}))}}]),t}(a.Component));var f,p=[{name:"headphones",text:"This experience requires sound.<br/>Headphones are recommended.",textPos:10,noAudio:!0},{name:"bed"},{name:"shower"},{name:"street"},{name:"parks"},{name:"plaque"},{name:"garbagedump"},{name:"slide"},{name:"bench"},{name:"fountain"},{name:"drugdealers"},{name:"dolores"},{name:"urethra"},{name:"forest"},{name:"forest2"},{name:"canal"},{name:"slidetop"},{name:"poem"}];!function(e){e[e.NotStarted=0]="NotStarted",e[e.Playing=1]="Playing",e[e.Complete=2]="Complete"}(f||(f={}));var h=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(d.a)(t).call(this,e))).playerRef=o.a.createRef(),n.progressBarRef=o.a.createRef(),n.cache={},n.clickedNext=function(){var e=n.state.index>=p.length-1?0:n.state.index+1;n.setState({index:e,keypressIndex:0,playState:f.NotStarted});var t=p[e],a=n.cache[t.name];setTimeout(function(){n.playerRef.current&&(n.playerRef.current.loadVideo(a),n.setState({playState:f.Playing}))},10)},n.stopAudio=function(){n.playerRef.current&&n.playerRef.current.pause()},n.onComplete=function(){console.log("Is complete!"),n.setState({playState:f.Complete})},n.state={index:0,keypressIndex:0,keyTimeout:1e3,playState:f.NotStarted,loaded:!1,loadingProgress:0},n}return Object(l.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;function t(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))}window.addEventListener("resize",t),t(),function(e,t){var n=0,a=e.length,o=""!=document.createElement("video").canPlayType("video/webm")?"webm":"mp4";function r(e){return fetch(e,{mode:"cors"}).then(function(e){return e.blob()}).then(URL.createObjectURL).catch(function(t){return console.log("Couldn't load ".concat(e,", ").concat(t))})}var i=e.map(function(e){return{bgaudio:"bgaudio/".concat(e,".mp3"),dialog:"dialog/".concat(e,".mp3"),name:e,video:"cinemagraphs/".concat(e,".").concat(o)}}).map(function(e){var t=[e.bgaudio,e.dialog,e.video];return Promise.all(t.map(r)).then(function(t){return{bgaudio:t[0],dialog:t[1],name:e.name,video:t[2]}})});return Promise.all(i.map(function(e){return e.then(function(e){n+=1;var o=Math.floor(n/a*100);return t(o),e})})).then(function(e){var t={};return e.forEach(function(e){t[e.name]=e}),t})}(p.map(function(e){return e.name}),function(t){e.progressBarRef.current&&(e.progressBarRef.current.value=t)}).then(function(t){e.cache=t,e.setState({loaded:!0});var n=p[0],a=e.cache[n.name];setTimeout(function(){e.playerRef.current.loadVideo(a)},100)})}},{key:"render",value:function(){if(console.log("Re-rendering"),!this.state.loaded)return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"video-wrapper"},o.a.createElement("div",null,"Loading!"),o.a.createElement("progress",{ref:this.progressBarRef,value:this.state.loadingProgress,max:"100"})));var e,t=p[this.state.index],n=o.a.createElement("div",{id:"next-wrapper",onClick:this.clickedNext,className:t.noAudio||this.state.playState===f.Complete?"visible":"hidden"},o.a.createElement("div",{id:"next"},"\u2192"));return t.text&&(e=o.a.createElement("div",{className:"text",dangerouslySetInnerHTML:{__html:t.text},style:{top:"".concat(t.textPos,"%")}})),o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"video-wrapper"},o.a.createElement(m,{media:this.cache[t.name],ref:this.playerRef,onComplete:this.onComplete}),e,n))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(h,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,n){e.exports=n(18)}},[[8,2,1]]]);
//# sourceMappingURL=main.fc00f4f6.chunk.js.map